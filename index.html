<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfólio Profissional</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Inclua o Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <style>
        :root {
            --primary-color: #121212;
            --secondary-color: #2a2a2a;
            --accent-color: #4e9af1;
            --light-gray: #1e1e1e;
            --medium-gray: #3d3d3d;
            --dark-gray: #0a0a0a;
            --silver: #e0e0e0;
            --text-color: #f5f5f5;
            --text-light: #ffffff;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--primary-color);
            color: var(--text-color);
            line-height: 1.6;
        }
        
        /* Cabeçalho com efeito xadrez */
        header {
            background: 
                linear-gradient(135deg, 
                    rgba(10, 10, 10, 0.9) 0%, 
                    rgba(20, 20, 20, 0.9) 100%),
                repeating-linear-gradient(
                    45deg,
                    var(--dark-gray),
                    var(--dark-gray) 10px,
                    #1a1a1a 10px,
                    #1a1a1a 20px
                );
            color: var(--text-light);
            padding: 2rem 0;
            text-align: center;
            position: relative;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
        }
        
        .container {
            width: 85%;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            color: var(--text-light);
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
            position: relative;
            display: inline-block;
        }
        
        h1::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--accent-color);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }
        
        header:hover h1::after {
            transform: scaleX(1);
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 1.5rem;
            color: var(--silver);
        }
        
        /* Botão Editar */
        .edit-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(78, 154, 241, 0.3);
        }
        
        .edit-btn:hover {
            background: #3a86d4;
            transform: translateY(-2px);
            box-shadow: 0 0 15px rgba(78, 154, 241, 0.6);
        }
        
        /* Modal de Edição */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: var(--secondary-color);
            padding: 2rem;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid var(--accent-color);
            color: var(--text-color);
        }
        
        .modal h2 {
            margin-bottom: 1.5rem;
            color: var(--accent-color);
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }
        
        .form-group input, 
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid var(--medium-gray);
            border-radius: 4px;
            font-size: 1rem;
            background-color: var(--primary-color);
            color: var(--text-color);
        }
        
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .modal-btns {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }
        
        .btn {
            padding: 0.6rem 1.2rem;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            border: none;
        }
        
        .btn-primary {
            background: var(--accent-color);
            color: white;
            box-shadow: 0 0 10px rgba(78, 154, 241, 0.3);
        }
        
        .btn-primary:hover {
            background: #3a86d4;
            box-shadow: 0 0 15px rgba(78, 154, 241, 0.6);
        }
        
        .btn-secondary {
            background: var(--medium-gray);
            color: var(--text-color);
        }
        
        .btn-secondary:hover {
            background: #5a6a7a;
        }
        
        /* Seção Sobre */
        #about {
            padding: 3rem 0;
            background-color: var(--secondary-color);
            border-bottom: 1px solid var(--medium-gray);
        }
        
        .about-content {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 2rem;
        }
        
        .profile-img {
            flex: 1;
            min-width: 300px;
            text-align: center;
            position: relative;
        }
        
        .profile-img img {
            width: 100%;
            max-width: 350px;
            border-radius: 50%;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            border: 5px solid var(--accent-color);
        }
        
        .bio {
            flex: 2;
            min-width: 300px;
        }
        
        h2 {
            font-size: 2rem;
            margin-bottom: 1.5rem;
            color: var(--accent-color);
        }
        
        /* Seção Projetos */
        #projects {
            padding: 3rem 0;
            background-color: var(--primary-color);
        }
        
        .projects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }
        
        .project-card {
            background: var(--secondary-color);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            position: relative;
            border: 1px solid var(--medium-gray);
        }
        
        .project-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(78, 154, 241, 0.2);
        }
        
        .project-img {
            height: 200px;
            overflow: hidden;
        }
        
        .project-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        
        .project-card:hover .project-img img {
            transform: scale(1.05);
        }
        
        .project-info {
            padding: 1.5rem;
        }
        
        .project-info h3 {
            margin-bottom: 0.5rem;
            color: var(--accent-color);
        }
        
        .project-info p {
            margin-bottom: 1rem;
            color: var(--silver);
        }
        
        .project-actions {
            position: absolute;
            top: 10px;
            right: 10px;
            display: none;
            gap: 0.5rem;
        }
        
        .project-card:hover .project-actions {
            display: flex;
        }
        
        .action-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: none;
            background: rgba(0,0,0,0.7);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .action-btn:hover {
            background: var(--accent-color);
            transform: scale(1.1);
        }
        
        /* Botões de Redes Sociais */
        .social-buttons {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin: 2rem 0;
            flex-wrap: wrap;
        }
        
        .social-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--dark-gray);
            color: white;
            font-size: 1.5rem;
            text-decoration: none;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 10px rgba(78, 154, 241, 0.5);
        }
        
        .social-btn::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.3));
            transform: translateX(-100%);
            transition: transform 0.3s ease;
        }
        
        .social-btn:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 0 20px rgba(78, 154, 241, 0.8);
        }
        
        .social-btn:hover::before {
            transform: translateX(100%);
        }
        
        .social-btn.linkedin { background: #0077B5; }
        .social-btn.github { background: #333; }
        .social-btn.whatsapp { background: #25D366; }
        .social-btn.curriculo { background: var(--accent-color); font-size: 1.2rem; }
        
        .social-btn .tooltip {
            position: absolute;
            bottom: -40px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 0.3rem 0.6rem;
            border-radius: 4px;
            font-size: 0.8rem;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            white-space: nowrap;
        }
        
        .social-btn:hover .tooltip {
            opacity: 1;
        }
        
        /* Seção Contato */
        #contact {
            padding: 3rem 0;
            background-color: var(--secondary-color);
            text-align: center;
            border-top: 1px solid var(--medium-gray);
        }
        
        /* Rodapé */
        footer {
            background: var(--dark-gray);
            color: var(--text-light);
            text-align: center;
            padding: 1.5rem 0;
            border-top: 1px solid var(--accent-color);
        }
        
        /* Upload de Imagem */
        .image-upload-container {
            margin-bottom: 1rem;
        }
        
        .image-preview {
            width: 100%;
            max-height: 200px;
            object-fit: contain;
            margin-top: 1rem;
            border-radius: 4px;
            display: none;
        }
        
        .upload-btn {
            display: inline-block;
            padding: 0.5rem 1rem;
            background: var(--medium-gray);
            color: var(--text-color);
            border-radius: 4px;
            cursor: pointer;
            margin-top: 0.5rem;
            transition: all 0.3s ease;
        }
        
        .upload-btn:hover {
            background: #5a6a7a;
        }
        
        /* Loading */
        .loading {
            display: none;
            text-align: center;
            margin: 1rem 0;
        }
        
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 4px solid var(--accent-color);
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Mensagens de erro */
        .error-message {
            color: #ff6b6b;
            font-size: 0.9rem;
            margin-top: 0.5rem;
            display: none;
        }
        
        /* Responsividade */
        @media (max-width: 768px) {
            .about-content {
                flex-direction: column;
            }
            
            .profile-img, .bio {
                flex: none;
                width: 100%;
            }
            
            .social-buttons {
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Cabeçalho -->
    <header>
        <div class="container">
            <button class="edit-btn" id="editPortfolioBtn">
                <i class="fas fa-edit"></i> Editar Portfólio
            </button>
            <h1 id="userName">Carregando...</h1>
            <p class="subtitle" id="userTitle">Carregando...</p>
            
            <!-- Botões de Redes Sociais -->
            <div class="social-buttons">
                <a href="#" class="social-btn linkedin" id="linkedinBtn">
                    <i class="fab fa-linkedin-in"></i>
                    <span class="tooltip">LinkedIn</span>
                </a>
                <a href="#" class="social-btn github" id="githubBtn">
                    <i class="fab fa-github"></i>
                    <span class="tooltip">GitHub</span>
                </a>
                <a href="#" class="social-btn whatsapp" id="whatsappBtn">
                    <i class="fab fa-whatsapp"></i>
                    <span class="tooltip">WhatsApp</span>
                </a>
                <a href="#" class="social-btn curriculo" id="resumeBtn">
                    <i class="fas fa-file-pdf"></i>
                    <span class="tooltip">Currículo</span>
                </a>
            </div>
        </div>
    </header>
    
    <!-- Seção Sobre -->
    <section id="about">
        <div class="container">
            <h2>Sobre Mim</h2>
            <div class="about-content">
                <div class="profile-img">
                    <img src="" alt="Sua Foto" id="profileImage">
                </div>
                <div class="bio">
                    <p id="aboutText">Carregando...</p>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Seção Projetos -->
    <section id="projects">
        <div class="container">
            <h2>Meus Projetos</h2>
            <div class="projects-grid" id="projectsContainer">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>Carregando projetos...</p>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Seção Contato -->
    <section id="contact">
        <div class="container">
            <h2>Entre em Contato</h2>
            <p>Interessado em trabalhar juntos ou quer saber mais sobre meu trabalho? Entre em contato!</p>
        </div>
    </section>
    
    <!-- Rodapé -->
    <footer>
        <div class="container">
            <p>&copy; <span id="year"></span> <span id="footerName">Carregando...</span>. Todos os direitos reservados.</p>
        </div>
    </footer>
    
    <!-- Modal de Login -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <h2>Acesso ao Editor</h2>
            <div class="form-group">
                <label for="password">Senha:</label>
                <input type="password" id="password" placeholder="Digite a senha">
            </div>
            <div class="modal-btns">
                <button class="btn btn-secondary" id="cancelLoginBtn">Cancelar</button>
                <button class="btn btn-primary" id="confirmLoginBtn">Acessar</button>
            </div>
        </div>
    </div>
    
    <!-- Modal de Edição de Perfil -->
    <div class="modal" id="editProfileModal">
        <div class="modal-content">
            <h2>Editar Perfil</h2>
            <div class="form-group">
                <label for="editName">Nome:</label>
                <input type="text" id="editName" placeholder="Seu nome completo">
            </div>
            <div class="form-group">
                <label for="editTitle">Título:</label>
                <input type="text" id="editTitle" placeholder="Sua profissão/especialidade">
            </div>
            <div class="image-upload-container">
                <label>Foto de Perfil:</label>
                <input type="file" id="profileImageUpload" accept="image/*" style="display: none;">
                <button class="upload-btn" id="profileImageUploadBtn">Escolher Imagem</button>
                <span class="error-message" id="profileImageError"></span>
                <img id="profileImagePreview" class="image-preview" src="" alt="Pré-visualização">
            </div>
            <div class="form-group">
                <label for="editAbout">Sobre:</label>
                <textarea id="editAbout" placeholder="Fale sobre você"></textarea>
            </div>
            <div class="loading" id="profileLoading">
                <div class="loading-spinner"></div>
                <p>Salvando alterações...</p>
            </div>
            <div class="modal-btns">
                <button class="btn btn-secondary" id="cancelProfileEditBtn">Cancelar</button>
                <button class="btn btn-primary" id="saveProfileBtn">Salvar</button>
            </div>
        </div>
    </div>
    
    <!-- Modal de Edição de Links Sociais -->
    <div class="modal" id="editSocialModal">
        <div class="modal-content">
            <h2>Editar Links Sociais</h2>
            <div class="form-group">
                <label for="editLinkedin">LinkedIn:</label>
                <input type="url" id="editLinkedin" placeholder="URL do seu LinkedIn">
            </div>
            <div class="form-group">
                <label for="editGithub">GitHub:</label>
                <input type="url" id="editGithub" placeholder="URL do seu GitHub">
            </div>
            <div class="form-group">
                <label for="editWhatsapp">WhatsApp:</label>
                <input type="url" id="editWhatsapp" placeholder="URL do seu WhatsApp">
            </div>
            <div class="form-group">
                <label for="editResume">Currículo:</label>
                <input type="url" id="editResume" placeholder="URL do seu currículo (PDF)">
            </div>
            <div class="loading" id="socialLoading">
                <div class="loading-spinner"></div>
                <p>Salvando alterações...</p>
            </div>
            <div class="modal-btns">
                <button class="btn btn-secondary" id="cancelSocialEditBtn">Cancelar</button>
                <button class="btn btn-primary" id="saveSocialBtn">Salvar</button>
            </div>
        </div>
    </div>
    
    <!-- Modal de Edição de Projeto -->
    <div class="modal" id="editProjectModal">
        <div class="modal-content">
            <h2 id="projectModalTitle">Adicionar Novo Projeto</h2>
            <div class="form-group">
                <label for="projectTitle">Título do Projeto:</label>
                <input type="text" id="projectTitle" placeholder="Nome do projeto">
            </div>
            <div class="form-group">
                <label for="projectDescription">Descrição:</label>
                <textarea id="projectDescription" placeholder="Descrição do projeto"></textarea>
            </div>
            <div class="image-upload-container">
                <label>Imagem do Projeto:</label>
                <input type="file" id="projectImageUpload" accept="image/*" style="display: none;">
                <button class="upload-btn" id="projectImageUploadBtn">Escolher Imagem</button>
                <span class="error-message" id="projectImageError"></span>
                <img id="projectImagePreview" class="image-preview" src="" alt="Pré-visualização">
            </div>
            <div class="form-group">
                <label for="projectLink">Link do Projeto:</label>
                <input type="url" id="projectLink" placeholder="URL do projeto">
            </div>
            <input type="hidden" id="projectIndex">
            <div class="loading" id="projectLoading">
                <div class="loading-spinner"></div>
                <p>Salvando projeto...</p>
            </div>
            <div class="modal-btns">
                <button class="btn btn-secondary" id="cancelProjectBtn">Cancelar</button>
                <button class="btn btn-primary" id="saveProjectBtn">Salvar</button>
            </div>
        </div>
    </div>

    <script>
        // Configuração do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDi9eMlOCjHP98JbvKjaJ5Ek6lMdjnJS6U",
            authDomain: "portfolio-emerson.firebaseapp.com",
            projectId: "portfolio-emerson",
            storageBucket: "portfolio-emerson.appspot.com",
            messagingSenderId: "23143093943",
            appId: "1:23143093943:web:c2b0458941e31de27d9f32"
        };

        // Inicializa o Firebase
        firebase.initializeApp(firebaseConfig);
        
        // Referências aos serviços do Firebase
        const db = firebase.firestore();
        const storage = firebase.storage();
        const auth = firebase.auth();
        
        // Referência ao documento do portfólio
        const portfolioRef = db.collection('portfolios').doc('emerson');
        
        // Variáveis de estado
        let isAuthenticated = false;
        let currentEditingProjectIndex = null;
        let profileImageFile = null;
        let projectImageFile = null;
        
        // Elementos do DOM
        const editPortfolioBtn = document.getElementById('editPortfolioBtn');
        const loginModal = document.getElementById('loginModal');
        const cancelLoginBtn = document.getElementById('cancelLoginBtn');
        const confirmLoginBtn = document.getElementById('confirmLoginBtn');
        const passwordInput = document.getElementById('password');
        
        const editProfileModal = document.getElementById('editProfileModal');
        const editName = document.getElementById('editName');
        const editTitle = document.getElementById('editTitle');
        const editAbout = document.getElementById('editAbout');
        const profileImageUpload = document.getElementById('profileImageUpload');
        const profileImageUploadBtn = document.getElementById('profileImageUploadBtn');
        const profileImagePreview = document.getElementById('profileImagePreview');
        const profileImageError = document.getElementById('profileImageError');
        const cancelProfileEditBtn = document.getElementById('cancelProfileEditBtn');
        const saveProfileBtn = document.getElementById('saveProfileBtn');
        const profileLoading = document.getElementById('profileLoading');
        
        const editSocialModal = document.getElementById('editSocialModal');
        const editLinkedin = document.getElementById('editLinkedin');
        const editGithub = document.getElementById('editGithub');
        const editWhatsapp = document.getElementById('editWhatsapp');
        const editResume = document.getElementById('editResume');
        const cancelSocialEditBtn = document.getElementById('cancelSocialEditBtn');
        const saveSocialBtn = document.getElementById('saveSocialBtn');
        const socialLoading = document.getElementById('socialLoading');
        
        const editProjectModal = document.getElementById('editProjectModal');
        const projectModalTitle = document.getElementById('projectModalTitle');
        const projectTitle = document.getElementById('projectTitle');
        const projectDescription = document.getElementById('projectDescription');
        const projectImageUpload = document.getElementById('projectImageUpload');
        const projectImageUploadBtn = document.getElementById('projectImageUploadBtn');
        const projectImagePreview = document.getElementById('projectImagePreview');
        const projectImageError = document.getElementById('projectImageError');
        const projectLink = document.getElementById('projectLink');
        const projectIndex = document.getElementById('projectIndex');
        const cancelProjectBtn = document.getElementById('cancelProjectBtn');
        const saveProjectBtn = document.getElementById('saveProjectBtn');
        const projectLoading = document.getElementById('projectLoading');
        
        const projectsContainer = document.getElementById('projectsContainer');
        
        // Carrega os dados do portfólio
        function loadPortfolioData() {
            portfolioRef.get().then(doc => {
                if (doc.exists) {
                    const data = doc.data();
                    
                    // Atualiza a UI com os dados
                    document.getElementById('userName').textContent = data.name || 'Seu Nome';
                    document.getElementById('userTitle').textContent = data.title || 'Sua Profissão';
                    document.getElementById('aboutText').textContent = data.about || 'Fale sobre você aqui.';
                    document.getElementById('footerName').textContent = data.name || 'Seu Nome';
                    
                    // Foto de perfil
                    if (data.imageUrl) {
                        document.getElementById('profileImage').src = data.imageUrl;
                    } else {
                        document.getElementById('profileImage').src = 'https://via.placeholder.com/350';
                    }
                    
                    // Links sociais
                    if (data.social) {
                        document.getElementById('linkedinBtn').href = data.social.linkedin || '#';
                        document.getElementById('githubBtn').href = data.social.github || '#';
                        document.getElementById('whatsappBtn').href = data.social.whatsapp || '#';
                        document.getElementById('resumeBtn').href = data.social.resume || '#';
                    }
                    
                    // Projetos
                    if (data.projects && data.projects.length > 0) {
                        renderProjects(data.projects);
                    } else {
                        projectsContainer.innerHTML = '<p>Nenhum projeto cadastrado ainda.</p>';
                    }
                } else {
                    // Cria um documento padrão se não existir
                    portfolioRef.set({
                        name: 'Seu Nome',
                        title: 'Sua Profissão',
                        about: 'Fale sobre você aqui.',
                        social: {
                            linkedin: '#',
                            github: '#',
                            whatsapp: '#',
                            resume: '#'
                        },
                        projects: []
                    }).then(() => {
                        loadPortfolioData();
                    });
                }
            }).catch(error => {
                console.error("Erro ao carregar portfólio:", error);
                alert("Erro ao carregar os dados. Por favor, recarregue a página.");
            });
        }
        
        // Renderiza os projetos
        function renderProjects(projects = []) {
            projectsContainer.innerHTML = '';
            
            if (projects.length === 0) {
                projectsContainer.innerHTML = '<p>Nenhum projeto cadastrado ainda.</p>';
                return;
            }
            
            projects.forEach((project, index) => {
                const projectCard = document.createElement('div');
                projectCard.className = 'project-card';
                projectCard.innerHTML = `
                    <div class="project-img">
                        <img src="${project.imageUrl || 'https://via.placeholder.com/400x200'}" alt="${project.title}">
                    </div>
                    <div class="project-info">
                        <h3>${project.title}</h3>
                        <p>${project.description}</p>
                        <a href="${project.link || '#'}" class="btn btn-primary" target="_blank">Ver Projeto</a>
                    </div>
                    ${isAuthenticated ? `
                    <div class="project-actions">
                        <button class="action-btn edit-project-btn" data-index="${index}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn delete-project-btn" data-index="${index}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    ` : ''}
                `;
                projectsContainer.appendChild(projectCard);
            });
            
            // Adiciona o botão de adicionar projeto se autenticado
            if (isAuthenticated) {
                const addProjectCard = document.createElement('div');
                addProjectCard.className = 'project-card add-project-card';
                addProjectCard.innerHTML = `
                    <div style="height: 100%; display: flex; align-items: center; justify-content: center; cursor: pointer;">
                        <i class="fas fa-plus" style="font-size: 3rem; color: var(--accent-color);"></i>
                    </div>
                `;
                addProjectCard.addEventListener('click', () => {
                    openProjectModal();
                });
                projectsContainer.appendChild(addProjectCard);
            }
            
            // Adiciona eventos aos botões de edição/exclusão
            document.querySelectorAll('.edit-project-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const index = parseInt(btn.getAttribute('data-index'));
                    openProjectModal(index, projects);
                });
            });
            
            document.querySelectorAll('.delete-project-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const index = parseInt(btn.getAttribute('data-index'));
                    if (confirm('Tem certeza que deseja excluir este projeto?')) {
                        deleteProject(index);
                    }
                });
            });
        }
        
        // Abre o modal de login
        editPortfolioBtn.addEventListener('click', () => {
            if (isAuthenticated) {
                openEditMenu();
            } else {
                loginModal.style.display = 'flex';
                passwordInput.focus();
            }
        });
        
        // Fecha o modal de login
        cancelLoginBtn.addEventListener('click', () => {
            loginModal.style.display = 'none';
            passwordInput.value = '';
        });
        
        // Confirma o login
        confirmLoginBtn.addEventListener('click', () => {
            const password = passwordInput.value;
            
            // Autenticação com a nova senha
            if (password === 'Crossfile14@') {
                isAuthenticated = true;
                loginModal.style.display = 'none';
                passwordInput.value = '';
                editPortfolioBtn.innerHTML = '<i class="fas fa-cog"></i> Opções de Edição';
                loadPortfolioData(); // Recarrega para mostrar botões de edição
                alert('Acesso concedido. Agora você pode editar o portfólio.');
            } else {
                alert('Senha incorreta. Tente novamente.');
            }
        });
        
        // Abre o menu de edição
        function openEditMenu() {
            const option = prompt(`Opções de Edição:
1 - Editar Perfil
2 - Editar Links Sociais
3 - Adicionar Projeto

Digite o número da opção desejada:`);
            
            if (option === '1') {
                openProfileModal();
            } else if (option === '2') {
                openSocialModal();
            } else if (option === '3') {
                openProjectModal();
            }
        }
        
        // Abre o modal de edição de perfil
        function openProfileModal() {
            portfolioRef.get().then(doc => {
                if (doc.exists) {
                    const data = doc.data();
                    editName.value = data.name || '';
                    editTitle.value = data.title || '';
                    editAbout.value = data.about || '';
                    
                    if (data.imageUrl) {
                        profileImagePreview.src = data.imageUrl;
                        profileImagePreview.style.display = 'block';
                    }
                    
                    editProfileModal.style.display = 'flex';
                }
            });
        }
        
        // Configura o upload da imagem de perfil
        profileImageUploadBtn.addEventListener('click', () => {
            profileImageUpload.click();
        });
        
        profileImageUpload.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                // Validação do tipo de arquivo
                if (!file.type.match('image.*')) {
                    profileImageError.textContent = 'Por favor, selecione um arquivo de imagem (JPEG, PNG, etc.)';
                    profileImageError.style.display = 'block';
                    return;
                }
                
                // Validação do tamanho do arquivo (máximo 5MB)
                if (file.size > 5 * 1024 * 1024) {
                    profileImageError.textContent = 'A imagem deve ter no máximo 5MB';
                    profileImageError.style.display = 'block';
                    return;
                }
                
                // Limpa mensagens de erro
                profileImageError.style.display = 'none';
                
                profileImageFile = file;
                const reader = new FileReader();
                reader.onload = (event) => {
                    profileImagePreview.src = event.target.result;
                    profileImagePreview.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        });
        
        // Fecha o modal de edição de perfil
        cancelProfileEditBtn.addEventListener('click', () => {
            editProfileModal.style.display = 'none';
            profileImageFile = null;
            profileImagePreview.src = '';
            profileImagePreview.style.display = 'none';
            profileImageError.style.display = 'none';
        });
        
        // Salva as alterações do perfil
        saveProfileBtn.addEventListener('click', async () => {
            const name = editName.value;
            const title = editTitle.value;
            const about = editAbout.value;
            
            if (!name || !title || !about) {
                alert('Por favor, preencha todos os campos obrigatórios.');
                return;
            }
            
            saveProfileBtn.disabled = true;
            profileLoading.style.display = 'block';
            
            try {
                let imageUrl = '';
                
                // Se uma nova imagem foi selecionada, faz upload
                if (profileImageFile) {
                    const storageRef = storage.ref(`profile_images/${Date.now()}_${profileImageFile.name}`);
                    const snapshot = await storageRef.put(profileImageFile);
                    imageUrl = await snapshot.ref.getDownloadURL();
                } else if (profileImagePreview.src && profileImagePreview.src.includes('http')) {
                    // Mantém a imagem existente se não foi alterada
                    imageUrl = profileImagePreview.src;
                }
                
                // Atualiza os dados no Firestore
                const updateData = {
                    name,
                    title,
                    about
                };
                
                if (imageUrl) {
                    updateData.imageUrl = imageUrl;
                }
                
                await portfolioRef.update(updateData);
                
                // Atualiza a UI
                loadPortfolioData();
                editProfileModal.style.display = 'none';
                profileImageFile = null;
                profileImagePreview.src = '';
                profileImagePreview.style.display = 'none';
                
                alert('Perfil atualizado com sucesso!');
            } catch (error) {
                console.error("Erro ao salvar perfil:", error);
                alert("Erro ao salvar as alterações. Por favor, tente novamente.");
            } finally {
                saveProfileBtn.disabled = false;
                profileLoading.style.display = 'none';
            }
        });
        
        // Abre o modal de edição de links sociais
        function openSocialModal() {
            portfolioRef.get().then(doc => {
                if (doc.exists) {
                    const data = doc.data();
                    
                    editLinkedin.value = data.social?.linkedin || '';
                    editGithub.value = data.social?.github || '';
                    editWhatsapp.value = data.social?.whatsapp || '';
                    editResume.value = data.social?.resume || '';
                    
                    editSocialModal.style.display = 'flex';
                }
            });
        }
        
        // Fecha o modal de edição de links sociais
        cancelSocialEditBtn.addEventListener('click', () => {
            editSocialModal.style.display = 'none';
        });
        
        // Salva as alterações dos links sociais
        saveSocialBtn.addEventListener('click', async () => {
            const socialData = {
                linkedin: editLinkedin.value,
                github: editGithub.value,
                whatsapp: editWhatsapp.value,
                resume: editResume.value
            };
            
            saveSocialBtn.disabled = true;
            socialLoading.style.display = 'block';
            
            try {
                await portfolioRef.update({
                    social: socialData
                });
                
                // Atualiza a UI
                loadPortfolioData();
                editSocialModal.style.display = 'none';
                
                alert('Links sociais atualizados com sucesso!');
            } catch (error) {
                console.error("Erro ao salvar links sociais:", error);
                alert("Erro ao salvar as alterações. Por favor, tente novamente.");
            } finally {
                saveSocialBtn.disabled = false;
                socialLoading.style.display = 'none';
            }
        });
        
        // Abre o modal de edição de projeto
        function openProjectModal(index = null, projects = null) {
            if (index !== null && projects) {
                // Editar projeto existente
                const project = projects[index];
                projectTitle.value = project.title || '';
                projectDescription.value = project.description || '';
                projectLink.value = project.link || '';
                projectIndex.value = index;
                projectModalTitle.textContent = 'Editar Projeto';
                currentEditingProjectIndex = index;
                
                if (project.imageUrl) {
                    projectImagePreview.src = project.imageUrl;
                    projectImagePreview.style.display = 'block';
                }
            } else {
                // Novo projeto
                projectTitle.value = '';
                projectDescription.value = '';
                projectLink.value = '';
                projectIndex.value = '';
                projectModalTitle.textContent = 'Adicionar Novo Projeto';
                currentEditingProjectIndex = null;
                projectImagePreview.src = '';
                projectImagePreview.style.display = 'none';
            }
            
            projectImageFile = null;
            projectImageError.style.display = 'none';
            editProjectModal.style.display = 'flex';
        }
        
        // Configura o upload da imagem do projeto
        projectImageUploadBtn.addEventListener('click', () => {
            projectImageUpload.click();
        });
        
        projectImageUpload.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                // Validação do tipo de arquivo
                if (!file.type.match('image.*')) {
                    projectImageError.textContent = 'Por favor, selecione um arquivo de imagem (JPEG, PNG, etc.)';
                    projectImageError.style.display = 'block';
                    return;
                }
                
                // Validação do tamanho do arquivo (máximo 5MB)
                if (file.size > 5 * 1024 * 1024) {
                    projectImageError.textContent = 'A imagem deve ter no máximo 5MB';
                    projectImageError.style.display = 'block';
                    return;
                }
                
                // Limpa mensagens de erro
                projectImageError.style.display = 'none';
                
                projectImageFile = file;
                const reader = new FileReader();
                reader.onload = (event) => {
                    projectImagePreview.src = event.target.result;
                    projectImagePreview.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        });
        
        // Fecha o modal de edição de projeto
        cancelProjectBtn.addEventListener('click', () => {
            editProjectModal.style.display = 'none';
            projectImageFile = null;
            projectImagePreview.src = '';
            projectImagePreview.style.display = 'none';
            projectImageError.style.display = 'none';
        });
        
        // Salva as alterações do projeto
        saveProjectBtn.addEventListener('click', async () => {
            const title = projectTitle.value;
            const description = projectDescription.value;
            const link = projectLink.value;
            
            if (!title || !description) {
                alert('Por favor, preencha pelo menos o título e a descrição do projeto.');
                return;
            }
            
            saveProjectBtn.disabled = true;
            projectLoading.style.display = 'block';
            
            try {
                let imageUrl = '';
                
                // Se uma nova imagem foi selecionada, faz upload
                if (projectImageFile) {
                    const storageRef = storage.ref(`project_images/${Date.now()}_${projectImageFile.name}`);
                    const snapshot = await storageRef.put(projectImageFile);
                    imageUrl = await snapshot.ref.getDownloadURL();
                } else if (projectImagePreview.src && projectImagePreview.src.includes('http')) {
                    // Mantém a imagem existente se não foi alterada
                    imageUrl = projectImagePreview.src;
                }
                
                // Obtém a lista atual de projetos
                const doc = await portfolioRef.get();
                const currentProjects = doc.data().projects || [];
                
                const projectData = {
                    title,
                    description,
                    link
                };
                
                if (imageUrl) {
                    projectData.imageUrl = imageUrl;
                }
                
                // Atualiza ou adiciona o projeto
                if (currentEditingProjectIndex !== null) {
                    currentProjects[currentEditingProjectIndex] = projectData;
                } else {
                    currentProjects.push(projectData);
                }
                
                // Atualiza os dados no Firestore
                await portfolioRef.update({
                    projects: currentProjects
                });
                
                // Atualiza a UI
                loadPortfolioData();
                editProjectModal.style.display = 'none';
                projectImageFile = null;
                projectImagePreview.src = '';
                projectImagePreview.style.display = 'none';
                
                alert('Projeto salvo com sucesso!');
            } catch (error) {
                console.error("Erro ao salvar projeto:", error);
                alert("Erro ao salvar o projeto. Por favor, tente novamente.");
            } finally {
                saveProjectBtn.disabled = false;
                projectLoading.style.display = 'none';
            }
        });
        
        // Exclui um projeto
        async function deleteProject(index) {
            if (!confirm('Tem certeza que deseja excluir este projeto?')) return;
            
            try {
                // Obtém a lista atual de projetos
                const doc = await portfolioRef.get();
                const currentProjects = doc.data().projects || [];
                
                // Remove o projeto
                currentProjects.splice(index, 1);
                
                // Atualiza os dados no Firestore
                await portfolioRef.update({
                    projects: currentProjects
                });
                
                // Atualiza a UI
                loadPortfolioData();
                
                alert('Projeto excluído com sucesso!');
            } catch (error) {
                console.error("Erro ao excluir projeto:", error);
                alert("Erro ao excluir o projeto. Por favor, tente novamente.");
            }
        }
        
        // Inicialização
        document.addEventListener('DOMContentLoaded', () => {
            // Atualiza o ano no rodapé
            document.getElementById('year').textContent = new Date().getFullYear();
            
            // Carrega os dados do portfólio
            loadPortfolioData();
        });
    </script>
</body>
</html>